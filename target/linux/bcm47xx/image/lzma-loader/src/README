/*
 * LZMA compressed kernel decompressor for bcm947xx boards
 *
 * Copyright (C) 2005 by Oleg I. Vdovikin <oleg@cs.msu.su>
 *
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU General Public License as published by
 * the Free Software Foundation; either version 2 of the License, or
 * (at your option) any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the GNU
 * General Public License for more details.
 *
 * You should have received a copy of the GNU General Public License
 * along with this program; if not, write to the Free Software
 * Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA 02111-1307 USA
 *
 */

The code is intended to decompress kernel, being compressed using lzma utility
build using 7zip LZMA SDK. This utility is located in the LZMA_Alone directory

decompressor code expects that your .trx file consist of three partitions: 

1) decompressor itself (this is gziped code which pmon/cfe will extract and run
on boot-up instead of real kernel)
2) LZMA compressed kernel (both streamed and regular modes are supported now)
3) Root filesystem

Please be sure to apply the following patch for use this new trx layout (it will
allow using both new and old trx files for root filesystem lookup code)

--- linuz/arch/mips/brcm-boards/bcm947xx/setup.c        2005-01-23 19:24:27.503322896 +0300
+++ linux/arch/mips/brcm-boards/bcm947xx/setup.c        2005-01-23 19:29:05.237100944 +0300
@@ -221,7 +221,9 @@
                /* Try looking at TRX header for rootfs offset */
                if (le32_to_cpu(trx->magic) == TRX_MAGIC) {
                        bcm947xx_parts[1].offset = off;
-                       if (le32_to_cpu(trx->offsets[1]) > off)
+                       if (le32_to_cpu(trx->offsets[2]) > off)
+                               off = le32_to_cpu(trx->offsets[2]);
+                       else if (le32_to_cpu(trx->offsets[1]) > off)
                                off = le32_to_cpu(trx->offsets[1]);
                        continue;
                }


Revision history:
	0.02	Initial release
	0.03	Added Mineharu Takahara <mtakahar@yahoo.com> patch to pass actual
		output size to decoder (stream mode compressed input is not 
		a requirement anymore)
	0.04	Reordered functions using lds script
